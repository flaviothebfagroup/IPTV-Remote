<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>BFA IPTV â€” Remote</title>
<link rel="manifest" href="/IPTV-/manifest.webmanifest"/><meta name="theme-color" content="#000000"/>
<link rel="icon" type="image/png" sizes="192x192" href="/IPTV-/icons/icon-192.png"/>
<link rel="icon" type="image/png" sizes="512x512" href="/IPTV-/icons/icon-512.png"/><link rel="apple-touch-icon" href="/IPTV-/icons/icon-192.png"/>
<style>
:root{--bg:#0b0b0c;--fg:#fff;--muted:#9a9aa0;--panel:#121214;--border:rgba(255,255,255,.14);--tile:#17171a;--accent:#ff9500}
body.light{--bg:#f5f5f7;--fg:#111;--muted:#6e6e73;--panel:#fff;--border:rgba(0,0,0,.12);--tile:#f2f2f7}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',system-ui,sans-serif}
.topbar{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 18px;border-bottom:1px solid var(--border);background:linear-gradient(0deg,transparent,rgba(0,0,0,.06));backdrop-filter:blur(10px)}
.logo{width:36px;height:36px;border-radius:10px;background:var(--tile) center/cover no-repeat;border:1px solid var(--border)}
a.nav{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:var(--tile);text-decoration:none;color:inherit}
.btn{height:34px;padding:0 14px;border-radius:999px;border:1px solid var(--border);background:var(--tile);color:var(--fg);font-weight:800;cursor:pointer}
.btn.primary{border-color:var(--accent);color:var(--accent);background:transparent}
.wrap{max-width:680px;margin:0 auto;padding:18px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:16px}
.small{font-size:12px}.muted{color:var(--muted)}
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;padding:10px 16px;border-radius:999px;font-weight:900;opacity:0;transition:opacity .25s;pointer-events:none;z-index:999}
.toast.show{opacity:1}.toast.err{background:#ff453a;color:#fff}
</style>
</head>
<body>
<div class="topbar">
  <div style="display:flex;align-items:center;gap:12px">
    <div id="brandLogo" class="logo"></div>
    <b>BFA IPTV â€” Remote</b>
    <a class="nav" href="home.html">Home</a>
    <a class="nav" href="dealership.html">Dealerships</a>
    <a class="nav" href="display.html">Displays</a>
    <a class="nav" href="user.html">Users</a>
    <a class="nav" href="more.html">More</a>
    <a class="nav" href="remote-control.html">Remote</a>
  </div>
  <div style="display:flex;align-items:center;gap:8px">
    <button id="themeBtn" class="btn">â˜€ï¸Ž/ðŸŒ™</button>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <h2 style="margin:0 0 8px">Control a display</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <select id="dealerSel" class="btn"><option value="">Select dealershipâ€¦</option></select>
      <select id="dispSel" class="btn"><option value="">Select displayâ€¦</option></select>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
      <button class="btn" data-ch="1">CH1</button><button class="btn" data-ch="2">CH2</button><button class="btn" data-ch="3">CH3</button><button class="btn" data-ch="4">CH4</button><button class="btn" data-ch="5">CH5</button>
      <label class="small muted">VOL <input id="vol" type="range" min="0" max="100" value="0" style="width:180px"></label>
      <button id="toggleMute" class="btn">Mute/Unmute</button>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, get, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
const firebaseConfig={apiKey:"AIzaSyBLSRS9PELXoI0wRafYKG5tx_UoRSawQaY",authDomain:"iptv-bfa.firebaseapp.com",databaseURL:"https://iptv-bfa-default-rtdb.firebaseio.com",projectId:"iptv-bfa",storageBucket:"iptv-bfa.firebasestorage.app",messagingSenderId:"838790935867",appId:"1:838790935867:web:1860eac7dbeb7159e1b31e"};
const LOGO_URL="https://flaviothebfagroup.github.io/IPTV-/icons/icon-512.png";
const app=initializeApp(firebaseConfig); const db=getDatabase(app);
const $=s=>document.querySelector(s); function toast(m,e=false){const t=$('#toast');t.textContent=m;t.className='toast show'+(e?' err':'');setTimeout(()=>t.classList.remove('show'),2200);}
$('#brandLogo').style.backgroundImage=`url("${LOGO_URL}")`;
let savedTheme=localStorage.getItem('iptv_theme'); if(!savedTheme){savedTheme='light';localStorage.setItem('iptv_theme','light');}
document.body.classList.toggle('light', savedTheme==='light'); $('#themeBtn').addEventListener('click',()=>{const isLight=!document.body.classList.contains('light');document.body.classList.toggle('light',isLight);localStorage.setItem('iptv_theme',isLight?'light':'dark');});

async function loadDealers(){ const sel=$('#dealerSel'); sel.innerHTML='<option value="">Select dealershipâ€¦</option>'; const p=await get(ref(db,'dealershipPublic')); const map=p.val()||{}; Object.entries(map).sort((a,b)=>(a[1]?.name||a[0]).localeCompare(b[1]?.name||b[0])).forEach(([id,v])=>{ const o=document.createElement('option'); o.value=id; o.textContent=v?.name||id; sel.appendChild(o); }); }
async function loadDisplays(did){ const sel=$('#dispSel'); sel.innerHTML='<option value="">Select displayâ€¦</option>'; if(!did) return; const d=await get(ref(db,`dealership/${did}/displays`)); const ids=d.exists()?Object.keys(d.val()||{}):[]; ids.sort().forEach(id=>{ const o=document.createElement('option'); o.value=id; o.textContent=id; sel.appendChild(o); }); }
$('#dealerSel').addEventListener('change',e=>{ loadDisplays(e.target.value); localStorage.setItem('iptv_sel_dealer', e.target.value||'');});
$('#dispSel').addEventListener('change',()=>localStorage.setItem('iptv_sel_display',$('#dispSel').value||''));
document.querySelectorAll('button[data-ch]').forEach(b=>b.addEventListener('click',()=>send({channel:parseInt(b.dataset.ch,10)})));
$('#vol').addEventListener('change',e=>send({volume:parseInt(e.target.value,10)}));
$('#toggleMute').addEventListener('click',async()=>{ const d=getSel(); if(!d) return; const s=await get(ref(db,`displays/${d.id}`)); const cur=!!(s.val()?.muted); send({muted:!cur}); });

function getSel(){ const dealership=$('#dealerSel').value, id=$('#dispSel').value; if(!dealership||!id){ toast('Pick dealership & display',true); return null; } return {dealership,id}; }
async function send(patch){ const d=getSel(); if(!d) return; await update(ref(db,`displays/${d.id}`),{...patch,dealership:d.dealership,timestamp:Date.now()}); toast('Sent'); }

(async ()=>{ await loadDealers(); const last=localStorage.getItem('iptv_sel_dealer')||''; if(last){ $('#dealerSel').value=last; await loadDisplays(last); const ld=localStorage.getItem('iptv_sel_display')||''; if(ld) $('#dispSel').value=ld; }})();
</script>
</body>
</html>